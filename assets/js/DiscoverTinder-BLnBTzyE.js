var e=Object.defineProperty,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,i=(e,i)=>{for(var l in i||(i={}))a.call(i,l)&&r(e,l,i[l]);if(s)for(var l of s(i))t.call(i,l)&&r(e,l,i[l]);return e},l=(e,s,a)=>new Promise((t,r)=>{var i=e=>{try{n(a.next(e))}catch(s){r(s)}},l=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,l);n((a=a.apply(e,s)).next())});import{r as n,j as o,W as d,Y as c,_ as m,z as x,k as u,$ as h,x as f,X as p,a0 as g,a1 as v,a2 as j,a3 as y,a4 as N,L as b,q as w,a5 as C,G as k,a6 as M,F as S}from"./react-vendor-CnY34O61.js";import{L as P}from"./Layout-r0cnXxiB.js";import{B as I,d as B,C as T,u as Y,t as _,c as O,S as A}from"./index-CjTRKdPh.js";import{m as F}from"./matchingEngine-Dm3fGxZW.js";import{N as z}from"./categories-niEc3ryh.js";import{P as R}from"./progress-DkfyDUd2.js";import{am as E,an as U,ao as $,ap as L}from"./vendor-CwuJVHC1.js";import{D,a as W,b as q,c as G,d as H,T as V,e as K}from"./textarea-C8We33Ur.js";import"./backend-vendor-CggdsxVJ.js";import"./ui-vendor-CttiZxwU.js";import"./utils-vendor-BkyaMd0J.js";import"./query-vendor-vr-56lSy.js";const Z=({match:e,onSwipeLeft:s,onSwipeRight:a,onInfo:t,style:r})=>{var l,f;const[p,g]=n.useState(0),[v,j]=n.useState(0),y=E(0),N=U(y,[-220,220],[-20,20]),b=U(y,[-240,-120,0,120,240],[0,1,1,1,0]),w=U(y,[-120,-60,0],[1,.4,0]),C=U(y,[0,60,120],[0,.4,1]);n.useEffect(()=>{j(0),g(0),y.set(0)},[e.groupId,y]);const k=e.loopPartners.length>0?e.loopPartners:[{userId:e.userB.userId,userName:e.userB.userName,location:e.userB.location,offersCategory:e.userB.offersCategory,needsCategory:e.userB.needsCategory,trustScore:e.userB.trustScore,relation:"mutual",hoursTheyProvide:e.userB.hoursOffered,hoursYouProvide:e.userB.hoursOffered}],M=null!=(l=k[v])?l:k[0],S=n.useMemo(()=>z.find(e=>e.id===(null==M?void 0:M.offersCategory)||e.name===(null==M?void 0:M.offersCategory)),[null==M?void 0:M.offersCategory]),P=n.useMemo(()=>z.find(e=>e.id===(null==M?void 0:M.needsCategory)||e.name===(null==M?void 0:M.needsCategory)),[null==M?void 0:M.needsCategory]),T=n.useMemo(()=>z.find(s=>s.id===e.myOfferCategory||s.name===e.myOfferCategory),[e.myOfferCategory]);n.useMemo(()=>z.find(s=>s.id===e.myNeedCategory||s.name===e.myNeedCategory),[e.myNeedCategory]);const Y=n.useMemo(()=>{var e;return null!=(e=k.find(e=>"receive_from"===e.relation||"mutual"===e.relation))?e:k[0]},[k]),_=n.useMemo(()=>{var e;return null!=(e=k.find(e=>"deliver_to"===e.relation&&e.userId!==Y.userId))?e:Y},[k,Y]);return o.jsxs($.div,{className:"absolute w-full h-full",style:i({x:y,rotate:N,opacity:b},r),drag:"x",dragConstraints:{left:0,right:0},onDragEnd:(e,t)=>{t.offset.x>100?(g(200),a()):t.offset.x<-100&&(g(-200),s())},animate:0!==p?{x:2*p}:{},transition:{type:"spring",stiffness:300,damping:30},children:[o.jsxs("div",{className:"relative w-full h-full bg-white/95 backdrop-blur rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-gray-100",children:[o.jsx("div",{className:"absolute inset-x-0 top-0 h-48 bg-gradient-to-br from-primary/15 via-accent/10 to-transparent pointer-events-none"}),o.jsxs("div",{className:"flex-1 p-6 flex flex-col relative",children:[o.jsxs("div",{className:"flex items-center justify-between mb-5",children:[o.jsxs(I,{className:(O=e.score,O>=85?"bg-green-500 text-white":O>=70?"bg-blue-500 text-white":O>=50?"bg-yellow-500 text-white":"bg-gray-500 text-white")+" text-sm font-semibold px-3 py-1.5",children:["🎯 ",e.score,"% Match"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-24",children:o.jsx(R,{value:e.score,className:"h-1.5"})}),o.jsx(B,{size:"icon",variant:"ghost",onClick:t,className:"rounded-full hover:bg-primary/10","aria-label":"More info",children:o.jsx(d,{className:"w-4 h-4 text-primary"})})]})]}),o.jsxs("div",{className:"flex items-start gap-4 flex-col sm:flex-row sm:items-center sm:gap-6",children:[o.jsx("div",{className:"w-28 h-28 shrink-0 rounded-2xl bg-gradient-to-tr from-primary/25 via-accent/30 to-white flex items-center justify-center text-5xl shadow-inner border border-white",children:(null==S?void 0:S.icon)||"👤"}),o.jsxs("div",{className:"flex-1 space-y-2 text-center sm:text-left",children:[o.jsx("h2",{className:"text-3xl font-brand font-semibold",children:M.userName}),o.jsxs("div",{className:"flex flex-wrap items-center justify-center sm:justify-start gap-3 text-muted-foreground text-sm",children:[M.location&&o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx(c,{className:"w-4 h-4"}),M.location]}),o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx(m,{className:"w-4 h-4 text-yellow-500"}),"Trust ",M.trustScore.toFixed(1)]}),o.jsx(I,{variant:"outline",className:"uppercase tracking-wide text-xs",children:"receive_from"===M.relation?"You receive from":"deliver_to"===M.relation?"You deliver to":"Mutual partner"})]})]})]}),k.length>1&&o.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 mt-4",children:k.map((e,s)=>{const a=s===v,t="receive_from"===e.relation?"You receive from":"deliver_to"===e.relation?"You deliver to":"Mutual partner";return o.jsx(B,{variant:a?"default":"outline",size:"sm",className:"rounded-full h-9 px-3",onClick:()=>j(s),children:o.jsxs("div",{className:"flex flex-col leading-tight text-left",children:[o.jsx("span",{className:"text-xs font-semibold",children:e.userName}),o.jsx("span",{className:"text-[10px] uppercase tracking-wide opacity-80",children:t})]})},e.userId)})}),o.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 mt-6",children:[o.jsxs("div",{className:"rounded-xl border border-primary/20 bg-primary/5 p-4 space-y-2",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-primary/70",children:"They offer"}),o.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[null==S?void 0:S.icon," ",(null==S?void 0:S.name)||M.offersCategory]}),o.jsxs("div",{className:"text-xs text-muted-foreground",children:[M.hoursTheyProvide," hrs available this cycle"]})]}),o.jsxs("div",{className:"rounded-xl border border-accent/30 bg-accent/10 p-4 space-y-2",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-accent-foreground/80",children:"They need"}),o.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[null==P?void 0:P.icon," ",(null==P?void 0:P.name)||M.needsCategory]}),o.jsxs("div",{className:"text-xs text-muted-foreground",children:["Exchange rate proposes ",e.exchangeRateBtoA.toFixed(1)," hrs from you"]})]})]}),o.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 mt-5",children:[o.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100 p-4",children:[o.jsx("div",{className:"text-xs font-semibold text-green-600 tracking-wide uppercase",children:"Potential Savings"}),o.jsxs("div",{className:"text-2xl font-bold text-green-700 mt-1",children:["₦",e.estimatedSavings.userA.toLocaleString()]}),o.jsx("div",{className:"text-xs text-green-700 mt-1",children:"by trading time instead of cash"})]}),o.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white p-4 space-y-2 shadow-sm",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Match insights"}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-muted-foreground",children:"Fair trade"}),o.jsx("span",{className:"font-medium",children:e.isBalancedTrade?"✅ Balanced":"Review terms"})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-muted-foreground",children:"Exchange parity"}),o.jsxs("span",{className:"font-medium",children:["1:",e.exchangeRateBtoA.toFixed(1)," hrs"]})]}),o.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[o.jsx("span",{children:"You receive from"}),o.jsx("span",{className:"font-medium text-foreground",children:Y.userName})]}),o.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[o.jsx("span",{children:"You deliver to"}),o.jsx("span",{className:"font-medium text-foreground",children:_.userName})]})]})]}),o.jsxs("div",{className:"mt-6 space-y-3",children:[o.jsxs("div",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-2 justify-center sm:justify-start",children:[o.jsx(x,{className:"w-4 h-4 text-primary"}),"Proposed exchange"]}),o.jsxs("div",{className:"grid sm:grid-cols-[1fr_auto_1fr] gap-4 items-center",children:[o.jsxs("div",{className:"p-3 rounded-lg border border-blue-200 bg-blue-50 flex items-center gap-3",children:[o.jsx(u,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-blue-600 font-semibold uppercase",children:"You offer"}),o.jsxs("div",{className:"text-sm font-bold",children:[_.hoursYouProvide.toFixed(1)," hrs of ",(null==T?void 0:T.name)||e.myOfferCategory]})]})]}),o.jsx("div",{className:"text-primary",children:o.jsx(h,{className:"w-6 h-6 mx-auto"})}),o.jsxs("div",{className:"p-3 rounded-lg border border-green-200 bg-green-50 flex items-center gap-3",children:[o.jsx(u,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-green-600 font-semibold uppercase",children:"You get"}),o.jsxs("div",{className:"text-sm font-bold",children:[Y.hoursTheyProvide.toFixed(1)," hrs of ",(null==(f=z.find(e=>e.id===Y.offersCategory||e.name===Y.offersCategory))?void 0:f.name)||Y.offersCategory]})]})]})]})]}),o.jsx("div",{className:"mt-auto pt-4 text-center text-xs text-muted-foreground",children:"Swipe left to pass • Swipe right to trade • Press ↑ for more details"})]})]}),o.jsx($.div,{className:"absolute top-1/2 left-8 transform -translate-y-1/2",style:{opacity:w},children:o.jsx("div",{className:"bg-red-500 text-white text-4xl font-bold rounded-full w-20 h-20 flex items-center justify-center shadow-lg rotate-[-20deg]",children:"❌"})}),o.jsx($.div,{className:"absolute top-1/2 right-8 transform -translate-y-1/2",style:{opacity:C},children:o.jsx("div",{className:"bg-green-500 text-white text-4xl font-bold rounded-full w-20 h-20 flex items-center justify-center shadow-lg rotate-[20deg]",children:"❤️"})})]});var O},J=({show:e,userName:s,userIcon:a,matchScore:t,tradeId:r,onClose:i,onMessage:l})=>{const n=f();return o.jsx(L,{children:e&&o.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:i,children:o.jsx($.div,{initial:{scale:.5,opacity:0,y:100},animate:{scale:1,opacity:1,y:0},exit:{scale:.5,opacity:0,y:100},transition:{type:"spring",duration:.5},onClick:e=>e.stopPropagation(),className:"w-full max-w-md mx-4",children:o.jsxs(T,{className:"relative overflow-hidden bg-gradient-to-br from-pink-50 via-white to-purple-50 border-2 border-pink-200",children:[o.jsx(B,{size:"sm",variant:"ghost",className:"absolute top-2 right-2 rounded-full",onClick:i,children:o.jsx(p,{className:"w-4 h-4"})}),o.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(20)].map((e,s)=>o.jsx($.div,{initial:{opacity:1,scale:0,x:"50%",y:"50%"},animate:{opacity:0,scale:1,x:100*Math.random()+"%",y:100*Math.random()+"%"},transition:{duration:1.5,delay:.05*s,ease:"easeOut"},className:"absolute",children:o.jsx(g,{className:"w-4 h-4 "+(s%2==0?"text-pink-400":"text-purple-400")})},s))}),o.jsxs("div",{className:"p-8 text-center relative",children:[o.jsxs($.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"mb-6",children:[o.jsx("div",{className:"text-6xl mb-2",children:"🎉"}),o.jsx("h2",{className:"text-3xl font-brand font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-600",children:"It's a Match!"})]}),o.jsx($.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring"},className:"mb-4",children:o.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-pink-200 to-purple-200 flex items-center justify-center text-5xl shadow-lg",children:a})}),o.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mb-2",children:o.jsx("p",{className:"text-xl font-semibold text-gray-800",children:s})}),o.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mb-6",children:o.jsxs("p",{className:"text-sm text-muted-foreground",children:["🎯 ",t,"% match • Perfect for trading!"]})}),o.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"space-y-3",children:[o.jsx(B,{className:"w-full bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600",size:"lg",onClick:()=>{n(r?`/trades/${r}`:"/trades"),i()},children:"View Trade Proposal"}),l&&o.jsxs(B,{variant:"outline",className:"w-full",size:"lg",onClick:()=>{l(),i()},children:[o.jsx(v,{className:"w-4 h-4 mr-2"}),"Send Message"]}),o.jsx(B,{variant:"ghost",className:"w-full",onClick:i,children:"Keep Swiping"})]}),o.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"mt-4 text-xs text-muted-foreground",children:"Trade proposal sent successfully! 🚀"})]})]})})})})},Q=({onPass:e,onTrade:s,onInfo:a,onUndo:t,canUndo:r=!1,disabled:i=!1})=>o.jsxs("div",{className:"py-6 space-y-3 text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-4",children:[r&&t&&o.jsx($.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},whileHover:{scale:1.08},whileTap:{scale:.92},children:o.jsx(B,{size:"lg",variant:"ghost",className:"rounded-full w-14 h-14 p-0 hover:bg-yellow-100",onClick:t,disabled:i,"aria-label":"Undo last swipe",children:o.jsx(j,{className:"w-6 h-6 text-yellow-600"})})}),o.jsx($.div,{whileHover:{scale:1.08},whileTap:{scale:.9},children:o.jsx(B,{size:"lg",variant:"outline",className:"rounded-full w-16 h-16 p-0 border-2 border-red-500 hover:bg-red-50 shadow-lg transition-all",onClick:e,disabled:i,"aria-label":"Pass on this match",children:o.jsx(p,{className:"w-8 h-8 text-red-500"})})}),o.jsx($.div,{whileHover:{scale:1.08},whileTap:{scale:.9},children:o.jsx(B,{size:"lg",variant:"outline",className:"rounded-full w-14 h-14 p-0 border-2 border-blue-500 hover:bg-blue-50 shadow-lg transition-all",onClick:a,disabled:i,"aria-label":"See more details",children:o.jsx(d,{className:"w-6 h-6 text-blue-500"})})}),o.jsx($.div,{whileHover:{scale:1.08},whileTap:{scale:.9},children:o.jsx(B,{size:"lg",className:"rounded-full w-16 h-16 p-0 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 shadow-lg transition-all",onClick:s,disabled:i,"aria-label":"Propose a trade",children:o.jsx(y,{className:"w-8 h-8 text-white fill-current"})})})]}),o.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-center gap-2",children:[o.jsx(N,{className:"w-4 h-4"}),"Use ← → arrows, ↑ for details, ↓ to undo"]})]}),X={title:"🎉 Match accepted",description:"We notified the other participant to finalise the trade."},ee={title:"Match passed",description:"We will prioritise better fits for you."};function se(){const{user:e}=Y(),[s,a]=n.useState([]),[t,r]=n.useState(0),[i,d]=n.useState(!0),[c,m]=n.useState(!1),[h,f]=n.useState(null),[p,g]=n.useState(!1),[v,j]=n.useState(null),[y,N]=n.useState([]),[E,U]=n.useState([]),[$,L]=n.useState(""),[se,ae]=n.useState(null),te=n.useRef(!1),re=n.useMemo(()=>s.length>0?s[t]:void 0,[s,t]),ie=n.useMemo(()=>s.length?Math.min(Math.round(t/s.length*100),100):0,[s.length,t]),le=n.useCallback(s=>{var a,t,r,i,l,n,o,d,c,m;if(!e)return null;const x=[...s.participants].sort((e,s)=>e.roleIndex-s.roleIndex),u=x.findIndex(s=>s.profile.id===e.id);if(-1===u)return null;const h=x[u],f=x.length;if(!h||f<2)return null;const p=(u-1+f)%f,g=x[(u+1)%f],v=x[p],j=e=>{var s;return null!=(s=e.profile.trust_score)?s:50},y=e=>Number(Math.max(1,j(e)/20+4-1).toFixed(1)),N=y(v),b=y(g),w=v.offerCategory,C=g.needCategory,k=[];2===f?k.push({userId:v.profile.id,userName:v.profile.display_name||"Matched Member",location:v.profile.location,offersCategory:v.offerCategory,needsCategory:v.needCategory,trustScore:j(v),relation:"mutual",hoursTheyProvide:N,hoursYouProvide:b}):(k.push({userId:v.profile.id,userName:v.profile.display_name||"Matched Member",location:v.profile.location,offersCategory:v.offerCategory,needsCategory:v.needCategory,trustScore:j(v),relation:"receive_from",hoursTheyProvide:N,hoursYouProvide:b}),g.profile.id!==v.profile.id&&k.push({userId:g.profile.id,userName:g.profile.display_name||"Matched Member",location:g.profile.location,offersCategory:g.offerCategory,needsCategory:g.needCategory,trustScore:j(g),relation:"deliver_to",hoursTheyProvide:0,hoursYouProvide:b}));const M=k[0],S=null!=(a=null==M?void 0:M.trustScore)?a:j(h),P=h.offerCategory===(null==M?void 0:M.needsCategory),I=Math.min(95,Math.round(.6*S+(P?35:20))),B=P?1:1.2,T=Math.max(1e4,Math.round(4500*(null!=(t=null==M?void 0:M.hoursTheyProvide)?t:N)+80*S));return{type:"three_way"===s.type?"3-way":"2-way",groupId:s.id,participantId:h.id,score:I,userB:{userId:null!=(r=null==M?void 0:M.userId)?r:v.profile.id,userName:null!=(i=null==M?void 0:M.userName)?i:v.profile.display_name||"Matched Member",location:null!=(l=null==M?void 0:M.location)?l:v.profile.location,category:null!=(n=null==M?void 0:M.offersCategory)?n:w,offersCategory:null!=(o=null==M?void 0:M.offersCategory)?o:w,needsCategory:null!=(d=null==M?void 0:M.needsCategory)?d:C,hoursOffered:null!=(c=null==M?void 0:M.hoursTheyProvide)?c:N,trustScore:null!=(m=null==M?void 0:M.trustScore)?m:S},exchangeRateAtoB:Number((1/B).toFixed(2)),exchangeRateBtoA:Number(B.toFixed(2)),isBalancedTrade:Math.abs(B-1)<.15,estimatedSavings:{userA:T,userB:Math.round(.8*T)},myOfferCategory:h.offerCategory,myNeedCategory:h.needCategory,loopPartners:k}},[e]),ne=n.useCallback(()=>l(this,null,function*(){if(!e)return a([]),void d(!1);try{d(!0),f(null);const s=(yield F.getMatchesForUser(e.id)).filter(e=>"pending"===e.status).map(le).filter(e=>Boolean(e));0===s.length&&f("We don't have swipe-ready matches yet. Update your services or try again soon."),a(s),r(e=>0===s.length?0:Math.min(e,s.length-1)),te.current=!1}catch(s){f("Failed to load matches. Please try again.")}finally{d(!1)}}),[e,le]);n.useEffect(()=>{ne()},[ne]),n.useEffect(()=>{!te.current&&s.length>0&&t>=s.length-2&&(te.current=!0,ne())},[t,s.length,ne]);const oe=n.useCallback(e=>{U(s=>[e,...s].slice(0,5))},[]),de=n.useCallback(()=>l(this,null,function*(){var e;if(re&&!c)try{m(!0),re.groupId&&(yield F.declineMatch(re.groupId)),oe({id:null!=(e=re.groupId)?e:`${re.userB.userId}-${Date.now()}`,decision:"pass",name:re.userB.userName,score:re.score}),N(e=>[...e,t]),r(e=>e+1),_(ee)}catch(s){_({variant:"destructive",title:"Could not pass on match",description:"Please try again."})}finally{m(!1)}}),[oe,t,re,c]),ce=n.useCallback(()=>l(this,null,function*(){var e,s;if(re&&!c)try{m(!0),re.groupId&&(yield F.acceptMatch(re.groupId,$)),oe({id:null!=(e=re.groupId)?e:`${re.userB.userId}-${Date.now()}`,decision:"trade",name:re.userB.userName,score:re.score}),N(e=>[...e,t]),r(e=>e+1),L(""),j({name:re.userB.userName,icon:(null==(s=z.find(e=>e.id===re.userB.offersCategory))?void 0:s.icon)||"👤",score:re.score}),g(!0),_(X)}catch(a){_({variant:"destructive",title:"Could not accept match",description:"Please try again."})}finally{m(!1)}}),[oe,t,re,c]),me=n.useCallback(()=>{re&&ae(re)},[re]),xe=n.useCallback(()=>{N(e=>{var s;if(0===e.length)return e;const a=[...e],t=null!=(s=a.pop())?s:0;return r(t),U(e=>e.slice(1)),a})},[]);(({onPass:e,onTrade:s,onInfo:a,onUndo:t,disabled:r=!1})=>{n.useEffect(()=>{if("undefined"==typeof window||r)return;const i=i=>{if(!r)switch(i.key){case"ArrowLeft":e();break;case"ArrowRight":s();break;case"ArrowUp":case"i":case"I":a();break;case"ArrowDown":case"u":case"U":case"z":case"Z":t&&t()}};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[e,s,a,t,r])})({onPass:de,onTrade:ce,onInfo:me,onUndo:y.length>0?xe:void 0,disabled:i||c||t>=s.length});const ue=n.useCallback(()=>o.jsx("div",{className:"flex items-center justify-center min-h-[600px]",children:o.jsx(T,{className:"max-w-md",children:o.jsxs(O,{className:"p-8 text-center space-y-4",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),o.jsx("h3",{className:"text-2xl font-brand font-bold",children:"No More Matches"}),o.jsx("p",{className:"text-muted-foreground",children:0===s.length?"We haven't found any matches yet. Add more services to increase your match potential!":"You've seen all available matches! Check back later for new opportunities."}),o.jsxs("div",{className:"space-y-2 pt-4",children:[o.jsx(B,{asChild:!0,className:"w-full",children:o.jsxs(b,{to:"/services",children:[o.jsx(x,{className:"w-4 h-4 mr-2"}),"Add More Services"]})}),o.jsxs(B,{variant:"outline",className:"w-full",onClick:ne,children:[o.jsx(w,{className:"w-4 h-4 mr-2"}),"Refresh Matches"]})]})]})})}),[ne,s.length]),he=n.useCallback(()=>o.jsx("div",{className:"flex items-center justify-center min-h-[600px]",children:o.jsxs("div",{className:"space-y-4 text-center",children:[o.jsx("div",{className:"animate-pulse text-6xl",children:"🔥"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(A,{className:"h-4 w-48 mx-auto"}),o.jsx(A,{className:"h-4 w-64 mx-auto"})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Matching you with the best trade opportunities..."})]})}),[]);return i?o.jsx(P,{children:o.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx(B,{variant:"ghost",asChild:!0,children:o.jsxs(b,{to:"/discover",children:[o.jsx(C,{className:"w-4 h-4 mr-2"}),"Back to Grid"]})}),o.jsxs(I,{variant:"outline",className:"gap-2",children:[o.jsx(k,{className:"w-4 h-4 text-orange-500"}),"Swipe Mode"]})]}),he()]})}):o.jsx(P,{children:o.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx(B,{variant:"ghost",asChild:!0,children:o.jsxs(b,{to:"/discover",children:[o.jsx(C,{className:"w-4 h-4 mr-2"}),"Back to Grid"]})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(I,{variant:"outline",className:"gap-2",children:[o.jsx(k,{className:"w-4 h-4 text-orange-500"}),"Swipe Mode"]}),s.length>0&&o.jsxs(I,{variant:"secondary",children:[Math.min(t+1,s.length)," / ",s.length]})]}),o.jsx(B,{variant:"ghost",asChild:!0,children:o.jsxs(b,{to:"/discover",children:[o.jsx(M,{className:"w-4 h-4 mr-2"}),"Grid View"]})})]}),h&&o.jsx(T,{className:"mb-6 border-yellow-200 bg-yellow-50",children:o.jsxs(O,{className:"p-4 flex items-center gap-3",children:[o.jsx(S,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),o.jsx("div",{className:"flex-1",children:o.jsx("p",{className:"text-sm font-medium text-yellow-800",children:h})}),o.jsxs(B,{variant:"outline",size:"sm",onClick:ne,children:[o.jsx(w,{className:"w-4 h-4 mr-2"}),"Retry"]})]})}),o.jsxs("div",{className:"mb-6 space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[o.jsx(x,{className:"w-4 h-4"}),s.length>0?`Viewing match ${Math.min(t+1,s.length)} of ${s.length}`:"No matches yet"]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[o.jsx(u,{className:"w-4 h-4"}),"Swipe or use arrow keys to respond quickly"]})]}),o.jsx(R,{value:ie,className:"h-2"})]}),t<s.length?o.jsx("div",{className:"relative",style:{height:"600px"},children:s.slice(t,t+3).map((e,s)=>o.jsx("div",{className:"absolute inset-0",style:{zIndex:3-s,transform:`scale(${1-.05*s}) translateY(${10*s}px)`,opacity:0===s?1:.5,pointerEvents:0===s?"auto":"none"},children:o.jsx(Z,{match:e,onSwipeLeft:de,onSwipeRight:ce,onInfo:me})},`${e.userB.userId}-${t+s}`))}):ue(),t<s.length&&o.jsx(Q,{onPass:de,onTrade:ce,onInfo:me,onUndo:xe,canUndo:y.length>0,disabled:c}),E.length>0&&o.jsxs("div",{className:"mt-4 border rounded-lg p-4 bg-muted/30",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground mb-2",children:"Recent decisions"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(e=>o.jsxs(I,{variant:"trade"===e.decision?"default":"outline",className:"gap-1",children:["trade"===e.decision?"✅":"⏭️"," ",e.name," ",o.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.score,"%"]})]},e.id))})]}),v&&o.jsx(J,{show:p,userName:v.name,userIcon:v.icon,matchScore:v.score,onClose:()=>g(!1)}),o.jsx(D,{open:!!se,onOpenChange:e=>!e&&ae(null),children:o.jsxs(W,{children:[o.jsxs(q,{children:[o.jsxs(G,{children:["About ",null==se?void 0:se.userB.userName]}),o.jsx(H,{children:"View detailed information about this trade opportunity"})]}),se&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold mb-2",children:"Match Details"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-muted-foreground",children:"Match Score:"}),o.jsxs("span",{className:"font-medium",children:[se.score,"%"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-muted-foreground",children:"Location:"}),o.jsx("span",{className:"font-medium",children:se.userB.location||"Not specified"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-muted-foreground",children:"Trust Score:"}),o.jsxs("span",{className:"font-medium",children:["⭐ ",se.userB.trustScore.toFixed(1),"/10"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-muted-foreground",children:"Fair Trade:"}),o.jsx("span",{className:"font-medium",children:se.isBalancedTrade?"✅ Yes":"⚠️ Review exchange terms"})]})]})]}),se.loopPartners.length>0&&o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold mb-2",children:"Loop Participants"}),o.jsx("div",{className:"space-y-2 text-sm",children:se.loopPartners.map(e=>o.jsxs("div",{className:"flex items-start justify-between rounded-lg border p-3",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:e.userName}),o.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:"receive_from"===e.relation?"You receive from this partner":"deliver_to"===e.relation?"You deliver to this partner":"Mutual trade partner"})]}),o.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[o.jsxs("div",{children:[e.hoursTheyProvide.toFixed(1)," hrs → you"]}),o.jsxs("div",{children:[e.hoursYouProvide.toFixed(1)," hrs ← you"]})]})]},e.userId))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold mb-2",children:"Add a Message (Optional)"}),o.jsx(V,{placeholder:"Tell them why you'd be a great trade partner...",value:$,onChange:e=>L(e.target.value),rows:3})]})]}),o.jsxs(K,{children:[o.jsx(B,{variant:"outline",onClick:()=>ae(null),children:"Close"}),o.jsx(B,{onClick:()=>{ae(null),ce()},disabled:c,children:"Accept Match"})]})]})})]})})}export{se as default};
