var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,i=(e,t,r)=>new Promise((n,a)=>{var i=e=>{try{c(r.next(e))}catch(t){a(t)}},o=e=>{try{c(r.throw(e))}catch(t){a(t)}},c=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,o);c((r=r.apply(e,t)).next())});import{s as o}from"./index-CjTRKdPh.js";const c=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getMatchesForUser(e){return i(this,null,function*(){yield this.refreshMatches();const{data:t,error:r}=yield o.from("match_groups").select("\n        id,\n        group_type,\n        status,\n        created_at,\n        updated_at,\n        participants:match_group_participants (\n          id,\n          role_index,\n          status,\n          offer_category,\n          need_category,\n          accepted_at,\n          profile:profile_id (\n            id,\n            display_name,\n            category,\n            location,\n            needs,\n            trust_score,\n            total_trades_completed,\n            average_response_hours,\n            phone_verified,\n            email_verified,\n            cac_verified\n          )\n        )\n      ").order("created_at",{ascending:!1});if(r)throw r;return(t||[]).map(t=>{var r;const n=(null!=(r=t.participants)?r:[]).map(e=>{var t;return{id:e.id,roleIndex:e.role_index,offerCategory:e.offer_category,needCategory:e.need_category,status:e.status,accepted_at:e.accepted_at,profile:null!=(t=e.profile)?t:{id:"",display_name:"Unknown"}}}),a=n.find(t=>t.profile.id===e);return{id:t.id,type:t.group_type,status:t.status,created_at:t.created_at,updated_at:t.updated_at,participants:n,myParticipant:a}})})}acceptMatch(e,c){return i(this,null,function*(){const i={p_match_group_id:e};c&&c.trim().length>0&&(i.p_intro_message=c.trim());const{error:s}=yield o.rpc("accept_match_participation",((e,i)=>{for(var o in i||(i={}))r.call(i,o)&&a(e,o,i[o]);if(t)for(var o of t(i))n.call(i,o)&&a(e,o,i[o]);return e})({},i));if(s)throw s})}declineMatch(e){return i(this,null,function*(){const{error:t}=yield o.rpc("decline_match_participation",{p_match_group_id:e});if(t)throw t})}refreshMatches(){return i(this,null,function*(){const{error:e}=yield o.rpc("refresh_match_groups");if(e&&"PGRST116"!==e.code)throw e})}};var s,p;a(c,"symbol"!=typeof(s="instance")?s+"":s,p);const d=c.getInstance();export{d as m};
