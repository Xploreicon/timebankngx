var e=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{c(a.next(e))}catch(s){i(s)}},l=e=>{try{c(a.throw(e))}catch(s){i(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,l);c((a=a.apply(e,s)).next())});import{r as s,j as a,F as t,q as i,G as r,L as l,I as c,z as n,k as d,E as o,J as m,K as x,O as h}from"./react-vendor-CnY34O61.js";import{L as p}from"./Layout-r0cnXxiB.js";import{u,e as j,S as g,d as f,B as v}from"./index-CjTRKdPh.js";import{I as N}from"./input-BR9g4TVH.js";import{S as y,a as b,b as w,c as C,d as k}from"./select-CCpwHlIZ.js";import{g as S,N as z}from"./categories-niEc3ryh.js";import{m as L}from"./matchingEngine-Dm3fGxZW.js";import"./vendor-CwuJVHC1.js";import"./backend-vendor-CggdsxVJ.js";import"./ui-vendor-CttiZxwU.js";import"./utils-vendor-BkyaMd0J.js";import"./query-vendor-vr-56lSy.js";const M=z;function A(){const{services:z,fetchServices:A,isLoading:F,user:P}=u(),[_,R]=s.useState(""),[T,q]=s.useState("all"),[E,W]=s.useState([]),[B,Y]=s.useState(!1),[D,I]=s.useState(null),[K,O]=s.useState(null),{toast:V}=j(),$=s.useCallback(()=>e(this,null,function*(){if(P)try{Y(!0);const e=yield L.getMatchesForUser(P.id);W(e)}catch(e){}finally{Y(!1)}else W([])}),[P]);s.useEffect(()=>{(()=>{e(this,null,function*(){try{O(null),yield A()}catch(e){O("Failed to load services. Please check your connection and try again.")}})})()},[A]),s.useEffect(()=>{$()},[$]);const G=s.useMemo(()=>z.filter(e=>{var s,a;return(!T||"all"===T||e.category===T)&&((null==(s=e.title)?void 0:s.toLowerCase().includes(_.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(_.toLowerCase())))}),[z,T,_]),J=E.filter(e=>"pending"===e.status),U=S(),H=()=>e(this,null,function*(){O(null),yield A()}),Q=s=>e(this,null,function*(){try{I(s),yield L.acceptMatch(s),V({title:"Match accepted",description:"We'll alert the other participants."}),yield $()}catch(e){V({variant:"destructive",title:"Could not accept match",description:e.message})}finally{I(null)}}),X=s=>e(this,null,function*(){try{I(s),yield L.declineMatch(s),V({title:"Match declined"}),yield $()}catch(e){V({variant:"destructive",title:"Could not decline match",description:e.message})}finally{I(null)}}),Z=e=>D===e;return F?a.jsx(p,{children:a.jsxs("div",{className:"grid lg:grid-cols-[260px_1fr] gap-6",children:[a.jsx(g,{className:"h-40 w-full"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(g,{className:"h-10 w-full"}),a.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((e,s)=>a.jsx(g,{className:"h-40 w-full"},s))})]})]})}):a.jsxs(p,{children:[K&&a.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[a.jsx(t,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"text-red-800 text-sm font-medium",children:K})}),a.jsxs(f,{size:"sm",variant:"outline",onClick:H,className:"flex-shrink-0",children:[a.jsx(i,{className:"h-4 w-4 mr-2"}),"Retry"]})]}),a.jsxs("div",{className:"mb-4 p-4 rounded-lg border-2 border-orange-200 bg-gradient-to-r from-orange-50 to-red-50 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(r,{className:"w-8 h-8 text-orange-500"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900",children:"ðŸ”¥ Try Swipe Mode!"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Like Tinder but for trading services. Find matches faster!"})]})]}),a.jsx(f,{asChild:!0,className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",children:a.jsxs(l,{to:"/discover/swipe",children:[a.jsx(r,{className:"w-4 h-4 mr-2"}),"Start Swiping"]})})]}),a.jsxs("main",{className:"grid lg:grid-cols-[260px_1fr] gap-6",children:[a.jsxs("aside",{className:"hidden lg:block border rounded-lg p-4 h-fit sticky top-20",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Filters"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs(y,{onValueChange:q,value:T,children:[a.jsx(b,{children:a.jsx(w,{placeholder:"All Categories"})}),a.jsxs(C,{children:[a.jsx(k,{value:"all",children:"All Categories"}),M.map(e=>a.jsxs(k,{value:e.id,children:[e.icon," ",e.name]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium mb-2",children:"Popular in Nigeria"}),a.jsx("div",{className:"space-y-1",children:U.map(e=>a.jsxs(f,{variant:T===e.id?"default":"ghost",size:"sm",className:"w-full justify-start",onClick:()=>q(e.id),children:[a.jsx("span",{className:"mr-2",children:e.icon}),e.name]},e.id))})]}),E.length>0&&a.jsxs("div",{className:"border-t pt-4 space-y-2",children:[a.jsxs("h4",{className:"text-sm font-medium flex items-center gap-1",children:[a.jsx(c,{className:"w-4 h-4"}),"Match summary"]}),E.slice(0,3).map(e=>a.jsxs("div",{className:"rounded-md border px-3 py-2 text-xs space-y-1",children:[a.jsx("p",{className:"font-medium capitalize",children:e.type.replace("_"," ")}),a.jsx("p",{className:"text-muted-foreground",children:e.participants.map(e=>e.profile.display_name||"Member").join(", ")}),a.jsxs("p",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:["Status: ",e.status]})]},e.id))]})]})]}),a.jsxs("section",{className:"space-y-6",id:"matches",children:[a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex gap-3",children:[a.jsx(N,{value:_,onChange:e=>R(e.target.value),placeholder:"Search services (e.g. 'legal help', 'website design')"}),a.jsx("div",{className:"lg:hidden w-48",children:a.jsxs(y,{onValueChange:q,value:T,children:[a.jsx(b,{children:a.jsx(w,{placeholder:"Category"})}),a.jsxs(C,{children:[a.jsx(k,{value:"all",children:"All"}),M.map(e=>a.jsxs(k,{value:e.id,children:[e.icon," ",e.name.split("&")[0].trim()]},e.id))]})]})})]}),J.length>0&&a.jsx("div",{className:"p-4 rounded-lg border-2 border-green-200 bg-green-50 text-green-800",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(n,{className:"w-5 h-5 mt-0.5 text-green-600"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"font-semibold",children:"ðŸŽ‰ Time trade opportunities waiting!"}),a.jsxs("p",{className:"text-sm",children:["You have ",J.length," pending trade",1!==J.length?"s":"",". Respond to keep the loop moving."]}),a.jsxs(f,{size:"sm",variant:"outline",onClick:$,disabled:B,children:[a.jsx(i,{className:"w-4 h-4 mr-2 "+(B?"animate-spin":"")}),"Refresh matches"]})]})]})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[a.jsx(n,{className:"w-5 h-5"}),"Match Proposals"]}),a.jsxs(f,{variant:"outline",size:"sm",onClick:$,disabled:B,children:[a.jsx(i,{className:"w-4 h-4 mr-2 "+(B?"animate-spin":"")}),"Refresh"]})]}),B&&0===E.length&&a.jsx(g,{className:"h-24 w-full"}),!B&&0===E.length&&a.jsxs("div",{className:"border rounded-lg p-6 text-center text-muted-foreground",children:[a.jsx(c,{className:"w-8 h-8 mx-auto mb-3 text-muted-foreground"}),a.jsx("p",{children:"No match proposals yet. Keep your profile updated and check back soon."})]}),a.jsx("div",{className:"grid gap-4",children:E.map(e=>{const s=e.myParticipant,t=e.participants.some(e=>"pending"===e.status&&e.id!==(null==s?void 0:s.id)),i=e.participants.every(e=>"accepted"===e.status);return a.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg capitalize",children:e.type.replace("_"," ")}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created ",new Date(e.created_at).toLocaleString()]})]}),a.jsx(v,{variant:"pending"===e.status?"outline":"secondary",className:"capitalize",children:e.status})]}),a.jsx("div",{className:"grid md:grid-cols-3 gap-3",children:e.participants.map(e=>a.jsxs("div",{className:"rounded-md border p-3 text-sm "+(e.profile.id===(null==s?void 0:s.profile.id)?"border-primary bg-primary/5":"bg-muted/40"),children:[a.jsxs("p",{className:"font-medium flex items-center gap-2",children:[e.profile.display_name||"Member","accepted"===e.status&&a.jsx(m,{className:"w-3 h-3 text-green-600"}),"declined"===e.status&&a.jsx(x,{className:"w-3 h-3 text-red-600"})]}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Offers ",a.jsx("strong",{children:e.offerCategory}),a.jsx("br",{}),"Needs ",a.jsx("strong",{children:e.needCategory})]}),e.profile.location&&a.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:e.profile.location})]},e.id))}),s&&"pending"===s.status&&"pending"===e.status&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsxs(f,{size:"sm",onClick:()=>Q(e.id),disabled:Z(e.id),children:[Z(e.id)&&a.jsx(h,{className:"w-4 h-4 mr-2 animate-spin"}),"Accept"]}),a.jsx(f,{size:"sm",variant:"outline",onClick:()=>X(e.id),disabled:Z(e.id),children:"Decline"}),t&&a.jsx("span",{className:"text-xs text-muted-foreground",children:"Waiting for other participantsâ€¦"})]}),s&&"accepted"===s.status&&"pending"===e.status&&a.jsx("p",{className:"text-xs text-muted-foreground",children:"You've accepted. We'll start the trade once everyone confirms."}),i&&"converted"===e.status&&a.jsx("p",{className:"text-xs text-green-700",children:"Everyone accepted! Trades have been created in your dashboard."})]},e.id)})})]}),a.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:G.map(e=>{const s=M.find(s=>s.id===e.category||s.name===e.category);return a.jsxs("article",{className:"border rounded-lg p-4 hover:shadow-md transition cursor-pointer group",children:[a.jsx("div",{className:"aspect-video w-full rounded-md bg-gradient-to-br from-accent/30 to-primary/5 mb-3 flex items-center justify-center text-4xl",children:(null==s?void 0:s.icon)||"ðŸ’¼"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsx("h4",{className:"font-semibold group-hover:text-primary transition-colors",children:e.title}),a.jsx(v,{variant:"secondary",className:"text-xs",children:(null==s?void 0:s.name)||e.category})]}),a.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description||"Professional service offering"}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(d,{className:"w-3 h-3"}),a.jsxs("span",{children:["â‚¦",(1e3*((null==s?void 0:s.baseRate)||5)).toLocaleString(),"/hr equivalent"]})]}),e.availability&&a.jsx(v,{variant:"outline",className:"text-green-600 border-green-200",children:"Available"})]}),a.jsx("div",{className:"pt-2 border-t",children:a.jsx(f,{size:"sm",className:"w-full",asChild:!0,children:a.jsx(l,{to:`/proposals?service=${e.id}&action=request`,children:"Start Trade"})})})]})]},e.id)})}),0===G.length&&!F&&!K&&a.jsx("div",{className:"text-center py-12",children:0===z.length?a.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[a.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-primary/10 flex items-center justify-center",children:a.jsx(d,{className:"h-8 w-8 text-primary"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Welcome to TimeBank!"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"No services available yet. Be the first to offer your skills and start trading time!"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[a.jsx(f,{asChild:!0,children:a.jsxs(l,{to:"/services",children:[a.jsx(o,{className:"h-4 w-4 mr-2"}),"Add Your First Service"]})}),a.jsxs(f,{variant:"outline",onClick:H,children:[a.jsx(i,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-muted-foreground",children:['No services match your search "',_,'" ',T&&"all"!==T&&`in ${T}`,"."]}),a.jsx(f,{variant:"outline",onClick:()=>{R(""),q("all")},children:"Clear Filters"})]})})]})]})]})}export{A as default};
