var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,t=(s,a,i)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,l=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&t(e,a,s[a]);if(i)for(var a of i(s))n.call(s,a)&&t(e,a,s[a]);return e},o=(e,i)=>s(e,a(i)),c=(e,s,a)=>new Promise((i,r)=>{var n=e=>{try{l(a.next(e))}catch(s){r(s)}},t=e=>{try{l(a.throw(e))}catch(s){r(s)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,t);l((a=a.apply(e,s)).next())});import{r as d,x as m,j as u,a5 as h,aB as p}from"./react-vendor-CnY34O61.js";import{u as x,C as f,a as y,b as v,c as j,d as g,t as b,s as N}from"./index-BBu7AVS9.js";import{I as w}from"./input-DGNBd0ih.js";import{L as k}from"./label-PSg-V1BV.js";import{S as P,a as C,b as _,c as O,d as E}from"./select-Cwmdi1fL.js";import{P as S}from"./progress-DpWD15xE.js";import{N as B}from"./categories-niEc3ryh.js";import"./vendor-CwuJVHC1.js";import"./backend-vendor-CggdsxVJ.js";import"./ui-vendor-CttiZxwU.js";import"./utils-vendor-BkyaMd0J.js";import"./query-vendor-DEKS82BJ.js";const F=["Basic Information","Location & Category","Email Verification","Complete Setup"],Y=B.map(e=>({label:e.name,id:e.id,icon:e.icon})),A=["Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta","Ebonyi","Edo","Ekiti","Enugu","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi","Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto","Taraba","Yobe","Zamfara","FCT"];function I(){var e,s;const[a,t]=d.useState(0),[B,I]=d.useState({display_name:"",phone:"",category:"",location:"",needs:[]}),[K,V]=d.useState(!1),{profile:L,updateProfile:D,completeOnboarding:T,setProfile:W,user:R}=x(),U=m(),[q,z]=d.useState(!1),[G,H]=d.useState(!1),J=d.useMemo(()=>{var e;return!!L&&(null!=(e=L.email_verified)&&e)},[L]);d.useEffect(()=>{L&&I(e=>({display_name:e.display_name||L.display_name||"",phone:L.phone||e.phone||"",category:e.category||L.category||"",location:e.location||L.location||"",needs:e.needs.length?e.needs:L.needs||[]}))},[L]),d.useEffect(()=>{var e,s,a;if(!L||K)return;let i=0;L.display_name&&""!==L.display_name.trim()&&(null!=(s=null==(e=L.needs)?void 0:e.length)?s:0)>0&&(i=1),L.category&&L.location&&(i=2),null!=(a=L.email_verified)&&a&&(i=3),t(i),V(!0)},[L,K]);const M=e=>{var s;return(null==(s=Y.find(s=>s.id===e))?void 0:s.label)||e},Z=M(B.category),Q=B.needs.length?B.needs.map(M).join(", "):"Not provided",X=(a+1)/F.length*100;return u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background/80 to-secondary/20 px-4",children:u.jsxs(f,{className:"w-full max-w-lg shadow-xl",children:[u.jsxs(y,{children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(v,{className:"text-xl font-brand",children:"Setup Your Profile"}),u.jsxs("span",{className:"text-sm text-muted-foreground",children:[a+1," of ",F.length]})]}),u.jsx(S,{value:X,className:"w-full"})]}),u.jsxs(j,{className:"space-y-6",children:[u.jsx("div",{className:"text-center",children:u.jsx("h3",{className:"text-lg font-semibold",children:F[a]})}),0===a&&u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(k,{htmlFor:"display_name",children:"Display Name"}),u.jsx(w,{id:"display_name",placeholder:"How should others see your name?",value:B.display_name,onChange:e=>I(o(l({},B),{display_name:e.target.value}))})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(k,{htmlFor:"phone",children:"Phone Number (optional)"}),u.jsx(w,{id:"phone",type:"tel",placeholder:"+234 xxx xxx xxxx",value:B.phone,onChange:e=>I(o(l({},B),{phone:e.target.value}))})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(k,{children:"What do you need help with?"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Select at least one area where you'd like support from the community."}),u.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(e=>u.jsxs(g,{type:"button",variant:B.needs.includes(e.id)?"default":"outline",size:"sm",onClick:()=>{return s=e.id,void I(e=>{const a=e.needs.includes(s);return o(l({},e),{needs:a?e.needs.filter(e=>e!==s):[...e.needs,s]})});var s},children:[u.jsx("span",{className:"mr-1",children:e.icon}),e.label]},e.id))})]})]}),1===a&&u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(k,{htmlFor:"category",children:"Primary Category"}),u.jsxs(P,{value:B.category||"",onValueChange:e=>I(o(l({},B),{category:e})),children:[u.jsx(C,{children:u.jsx(_,{placeholder:"Select your main expertise area"})}),u.jsx(O,{children:Y.map(e=>u.jsxs(E,{value:e.id,children:[u.jsx("span",{className:"mr-2",children:e.icon}),e.label]},e.id))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(k,{htmlFor:"location",children:"Location"}),u.jsxs(P,{value:B.location||"",onValueChange:e=>I(o(l({},B),{location:e})),children:[u.jsx(C,{children:u.jsx(_,{placeholder:"Select your city"})}),u.jsx(O,{children:A.map(e=>u.jsx(E,{value:e,children:e},e))})]})]})]}),2===a&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"text-center space-y-2",children:[u.jsx("h4",{className:"font-medium",children:"Verify Your Email Address"}),u.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent a confirmation link to ",u.jsx("strong",{children:null!=(e=null==L?void 0:L.email)?e:"your email address"}),". Please click the link to verify your account before continuing."]})]}),J?u.jsx("div",{className:"p-4 rounded-lg bg-green-50 border border-green-200 text-sm text-green-700 text-center",children:"Your email is verified. You can proceed to the final step."}):u.jsxs("div",{className:"space-y-3",children:[u.jsx(g,{variant:"outline",className:"w-full",disabled:q||!(null==L?void 0:L.email),onClick:()=>c(this,null,function*(){if(null==L?void 0:L.email)try{z(!0);const{error:e}=yield N.auth.resend({type:"signup",email:L.email});if(e)throw e;b({title:"Verification email sent",description:"Check your inbox and spam folder for the confirmation link."})}catch(e){b({variant:"destructive",title:"Unable to send email",description:e instanceof Error?e.message:"Please try again later."})}finally{z(!1)}else b({variant:"destructive",title:"Email unavailable",description:"Please contact support to update your email address."})}),children:q?"Sending…":"Resend Verification Email"}),u.jsx(g,{variant:"secondary",className:"w-full",disabled:G||!R,onClick:()=>c(this,null,function*(){if(R)try{H(!0);const{data:e,error:s}=yield N.from("profiles").select("*").eq("id",R.id).single();if(s)throw s;W(e),b({title:(null==e?void 0:e.email_verified)?"Email verified!":"Still waiting…",description:(null==e?void 0:e.email_verified)?"Thanks for confirming. You can proceed.":"We haven’t detected a verification yet. After clicking the email link, press this button again."})}catch(e){b({variant:"destructive",title:"Unable to refresh status",description:e instanceof Error?e.message:"Please try again later."})}finally{H(!1)}}),children:G?"Checking…":"I've verified my email"}),u.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Didn’t get the message? Ensure your email is correct, check spam, then resend or refresh the status above."})]})]}),3===a&&u.jsxs("div",{className:"text-center space-y-4",children:[u.jsxs("div",{className:"p-6 rounded-lg bg-secondary/50",children:[u.jsx("h4",{className:"font-semibold mb-2",children:"Profile Summary"}),u.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Name:"})," ",B.display_name]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Email:"})," ",null!=(s=null==L?void 0:L.email)?s:"Not provided"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Phone:"})," ",(null==L?void 0:L.phone)||B.phone||"Not provided"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Category:"})," ",Z||"Not set"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Location:"})," ",B.location]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Needs:"})," ",Q]})]})]}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"You're all set! Click finish to complete your profile setup."})]}),u.jsxs("div",{className:"flex justify-between pt-4",children:[u.jsxs(g,{variant:"outline",onClick:()=>{a>0&&t(e=>e-1)},disabled:0===a,children:[u.jsx(h,{className:"mr-2 h-4 w-4"}),"Back"]}),u.jsxs(g,{onClick:()=>c(this,null,function*(){if(a<F.length-1)t(e=>e+1);else{const e={display_name:B.display_name.trim()};B.category&&(e.category=B.category),B.location&&(e.location=B.location),B.phone&&(e.phone=B.phone),B.needs&&B.needs.length>0?e.needs=B.needs:e.needs=[];let{error:s}=yield D(e);if(s&&s.includes('column "needs"')){const a=e,{needs:t}=a,l=((e,s)=>{var a={};for(var t in e)r.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(null!=e&&i)for(var t of i(e))s.indexOf(t)<0&&n.call(e,t)&&(a[t]=e[t]);return a})(a,["needs"]);s=(yield D(l)).error}if(s)return void b({variant:"destructive",title:"Update Failed",description:s});const{error:a}=yield T();if(a)return void b({variant:"destructive",title:"Onboarding Failed",description:a});b({title:"Welcome to TimeBank!",description:"Your profile has been set up successfully."}),U("/dashboard")}}),disabled:!(()=>{switch(a){case 0:return""!==B.display_name.trim()&&B.needs.length>0;case 1:return""!==B.category&&""!==B.location;case 2:return!0;case 3:return""!==B.display_name.trim()&&""!==B.category&&""!==B.location;default:return!1}})(),children:[a===F.length-1?"Finish":"Next",a<F.length-1&&u.jsx(p,{className:"ml-2 h-4 w-4"})]})]})]})]})})}export{I as default};
